parameters:
  projectName:
  environmentName:
  azureServiceConnection:
  resourceGroupName:
  location:
  artifactPath:

steps:
- task: AzureCLI@2
  name: DeployInfra
  inputs:
    azureSubscription: ${{parameters.azureServiceConnection}}
    scriptType: 'pscore'
    scriptLocation: 'scriptPath'
    scriptPath: ${{parameters.artifactPath}}/deploy.ps1
    arguments: >
      -projectName ${{parameters.projectName}}
      -resourceGroup ${{parameters.resourceGroupName}}
      -location ${{parameters.location}}
      -environmentName ${{parameters.environmentName}}
      -bicepFile ${{parameters.artifactPath}}/bicep/azureDeploy.bicep
      -bicepParametersFile ${{parameters.artifactPath}}/azuredeploy.parameters.${{parameters.environmentName}}.json
      -secretApiKey '$(SecretAPIKey)'